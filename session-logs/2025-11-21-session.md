# Session Log - November 21, 2025

## Today's Accomplishments

### Major Fixes Completed
1. âœ… **Math Sequencing Bug**
   - Fixed: Math II no longer suggested in Fall when Math I is in Spring
   - Added `hasPrerequisiteInLaterQuarter()` method to check chronological order
   - Handles Math I/II/III and Foreign Language sequences

2. âœ… **Pathway Normalization**
   - Rewrote `normalizePathway()` to use UC/CSU category as source of truth
   - Fixed Web Design: History â†’ Fine Arts (UC: F)
   - Fixed American Literature & Humanities: History â†’ English (UC: B)
   - This fixed both History count AND Year 11 Spring course count issues

3. âœ… **Civil Engineering Term Length**
   - Changed from "yearlong" to "semester" in courses_complete.json

4. âœ… **History UC Requirements**
   - Verified 2+ History courses suggested by end of Year 3
   - All tests passing (4 History courses suggested, exceeds requirement)

5. âœ… **Target Suggestion Counts**
   - All semesters now meet targets:
     - Years 1-3: 4 courses/semester âœ“
     - Year 4: 3 courses/semester âœ“

6. âœ… **Semester Lock/Unlock Feature**
   - Added lock toggle buttons for each semester (Fall/Spring)
   - Locked semesters skip Auto-fill completely
   - State persists in localStorage
   - Visual feedback (red lock icon when locked, disabled button)

7. âœ… **Course Exclusions**
   - Never suggest ROTC courses
   - Never suggest Newcomer Class courses

### Code Quality
- Created 5 new modular utility classes:
  - `SuggestionEngine.js` - Main orchestrator
  - `CandidateRanker.js` - Priority-based scoring
  - `BusinessRules.js` - Validation constraints
  - `RequirementCalculator.js` - Unmet requirements tracking
  - `CatalogNormalizer.js` - Pathway normalization

- Reduced App.jsx from 2923 lines to much cleaner modular code
- Added 11 comprehensive test files
- All tests passing

### Git Operations
- Created `refactor/suggestion-engine` branch
- 20 commits with all fixes
- Successfully merged to `main`
- Pushed to GitHub
- Cleaned up merged branch `fix/ap-cs-a-requirements`

---

## Session 2 - Evening Updates (Completed)

### âœ… Fixes Completed This Session

1. **A-G Gaps Highest Priority in Years 10-11**
   - Updated CandidateRanker scoring: A-G gaps now 950-980 in Year 11, 920-950 in Year 10
   - Ensures UC requirements are prioritized before deadline

2. **Clear All Respects Locked Semesters**
   - Clear All button now preserves courses in locked semesters
   - Confirmation message updated to inform user

3. **Auto-fill 45 Credit Limit**
   - Auto-fill stops adding courses when semester would exceed 45 credits
   - Target is 40 credits per semester

4. **Math Sequence Fix (Lower-level blocking)**
   - Added `checkIntegratedMathSequence()` in BusinessRules.js
   - Math I no longer suggested when Math II is scheduled
   - Math III still allowed when Math II exists

5. **Lock Prevents Drag/Drop**
   - handleDragStart blocks dragging FROM locked semesters
   - handleDrop blocks dropping INTO locked semesters

6. **Double-click Course Selection**
   - Double-clicking a course in search results immediately adds it
   - Placeholder text updated with hint

7. **American Literature Pathway Fix**
   - Fixed pathway from "History/Social Science" to "English" (UC: B)

---

## To-Do List for Tomorrow

### ðŸ”´ HIGH PRIORITY

1. **Fix Course Card Heights**
   - Issue: Course cards have inconsistent heights
   - Solution: Make all course cards same height (taller)
   - Location: `src/components/course/CourseCard.jsx`
   - Add `min-h-[XXXpx]` class to ensure uniform height

2. **Fix Elective Credits Counting**
   - Issue: Something wrong with how we count the # of elective credits for Westview
   - Investigation needed: Check westviewProgress calculation in App.jsx
   - Location: `src/App.jsx` lines 384-410
   - Verify which pathways count as "Electives"
   - Check if CTE/Fine Arts/etc. are being counted correctly

### ðŸŸ¡ MEDIUM PRIORITY - UI/UX Improvements

3. **Remove AP Award Icon from Course Cards**
   - Issue: Little symbol on AP class cards is unnecessary
   - Solution: Remove Award icon display
   - Location: `src/components/course/CourseCard.jsx` lines 111-113
   - Remove the `<Award className="text-purple-600" />` component

4. **Fix AP Test Scores Section Alignment**
   - Issue: AP section does not left align with the other data
   - Solution: Adjust padding/margins in AP test scores display
   - Location: `src/App.jsx` - AP test scores section (search for "AP" and "Test Scores")
   - Ensure consistent left padding with other sections

5. **Add Edit Functionality for AP Courses**
   - Issue: Need to be able to edit previously added AP courses
   - Solution: Add edit button to AP course entries
   - Location: `src/App.jsx` - AP test scores display section
   - Add pencil/edit icon next to each AP entry
   - Open form with pre-filled data when clicked

### ðŸŸ¢ LOW PRIORITY

6. **Add Undo Button**
    - Issue: Need ability to undo course additions/deletions
    - Solution: Add undo/redo functionality
    - Location: `src/App.jsx`
    - Implementation ideas:
      - Track course history in state
      - Add Undo button in UI (top toolbar or per-year)
      - Keyboard shortcut: Ctrl+Z / Cmd+Z
      - Limit to last 10-20 actions

7. **Code Review**
    - Review BusinessRules for any other edge cases
    - Check if other subject sequences need similar treatment

---

## Files to Review Tomorrow

- `src/components/course/CourseCard.jsx` - Card height styling
- `src/utils/BusinessRules.js` - Foreign language rules (lines 282-338)
- `src/App.jsx` - Westview elective credits calculation (lines 384-410)
- `src/utils/CandidateRanker.js` - Math sequence scoring (lines 26-39)

---

## Technical Notes

### Foreign Language Issue Debug Starting Point:
```javascript
// BusinessRules.js line 282
checkForeignLanguageConsistency(course) {
  if (course.pathway !== 'Foreign Language') return true;
  // Check: Does this properly prevent multiple languages?
}

// BusinessRules.js line 309
checkSameSemesterLanguageLimit(course) {
  // Check: Is this preventing same language twice in semester?
}
```

### Elective Credits Issue Debug Starting Point:
```javascript
// App.jsx line 384 - westviewProgress calculation
// Need to verify which courses count toward "Electives" requirement
// CTE? Fine Arts? Off-Roll?
```

### Math 3 Timing Issue:
```javascript
// CandidateRanker.js - Add boost for Math 3 in Years 10-11
// Similar to how we handle A-G gaps with year-based priority
```

---

## Branch Status
- **main**: Up to date, all changes merged âœ…
- **refactor/suggestion-engine**: Can be deleted (already merged)

## Dev Server
- Running at http://localhost:3000/
- All features working
- Lock/unlock buttons visible and functional
